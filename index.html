<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Experiment</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; }
    .card { max-width: 760px; border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
    .hidden { display: none; }
    /* ===== 4AFC choice layout ===== */
    #afcChoices{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 16px;
    }
  
    #afcChoices button{
      width:100%;
      padding: 12px;
      font-size: 16px;
    }
    label { display:block; margin: 10px 0 6px; }
    input, select { width: 100%; padding: 8px; font-size: 16px; }
    button { padding: 10px 14px; font-size: 16px; cursor: pointer; }
    .note { font-size: 14px; color:#444; }
    .loadingBox { margin-top: 12px; padding: 10px; background:#f7f7f7; border-radius:10px; }
    .spinner {
      display:inline-block; width:14px; height:14px;
      border:2px solid #ccc; border-top-color:#333;
      border-radius:50%; animation:spin 0.8s linear infinite;
      margin-right:8px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>

<body>
<h1>ì‹¤í—˜ ì°¸ì—¬</h1>

<!-- ================== 1. Consent + Participant Info ================== -->
<div class="card" id="screen-consent">
  <h2>ì—°êµ¬ ì°¸ì—¬ ë™ì˜</h2>
  <p>
    ì´ ì‹¤í—˜ì—ì„œëŠ” ê·¸ë¦¼ì„ ë³´ê³  ë‹¨ì–´ë¥¼ ë§í•˜ê±°ë‚˜ ì„ íƒí•˜ëŠ” ê³¼ì œë¥¼ í•˜ê²Œ ë©ë‹ˆë‹¤.<br>
    ê° ë‹¨ê³„ë§ˆë‹¤ í™”ë©´ì— ì•ˆë‚´ê°€ ì œì‹œë©ë‹ˆë‹¤. ì•ˆë‚´ì— ë”°ë¼ ì§„í–‰í•´ ì£¼ì„¸ìš”.<br><br>
    ì‹¤í—˜ì€ ì—¬ëŸ¬ ë‹¨ê³„ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br>
    ê° ë‹¨ê³„ì—ì„œ ì§‘ì¤‘í•´ì„œ í™”ë©´ì„ ë³´ê³  ë°˜ì‘í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.<br>
    ì •ë‹µ ì—¬ë¶€ëŠ” ì‹¤í—˜ ì¤‘ì— ì•Œë ¤ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.<br><br>
    ë°˜ì‘ì‹œê°„ê³¼ ìŒì„±(ë…¹ìŒ)ì´ ìˆ˜ì§‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
    ì–¸ì œë“  ì¤‘ë‹¨í•  ìˆ˜ ìˆìœ¼ë©°, ë™ì˜í•˜ì§€ ì•Šìœ¼ë©´ ì°¸ì—¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
  </p>

  <label>
    <input type="checkbox" id="consentCheck">
    ìœ„ ë‚´ìš©ì„ ì½ì—ˆê³  ì—°êµ¬ ì°¸ì—¬ì— ë™ì˜í•©ë‹ˆë‹¤.
  </label>

  <hr>

  <h3>ì°¸ê°€ì ì •ë³´</h3>

  <label>ë‹‰ë„¤ì„ / ì´ë‹ˆì…œ (2ê¸€ì ì´ìƒ)</label>
  <input id="nick" placeholder="ì˜ˆ: HJ, MS (ì‹¤ëª… X)">

  <label>ìƒë…„ì›”</label>
  <input id="birthYM" type="month">

  <label>ëª¨êµ­ì–´</label>
  <input id="nativeLang" placeholder="ì˜ˆ: í•œêµ­ì–´">

  <label>ì™¸êµ­ì–´(ë“¤)</label>
  <input id="otherLangs" placeholder="ì˜ˆ: ì˜ì–´, ì¼ë³¸ì–´ (ì—†ìœ¼ë©´ 'ì—†ìŒ')">

  <button id="btnStart" disabled>ë™ì˜í•˜ê³  ì‹œì‘</button>

  <div id="loading" class="loadingBox hidden">
    <div><span class="spinner"></span><b>ì„¸ì…˜ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤â€¦</b></div>
    <div class="note">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</div>
  </div>
</div>

<!-- ================== 2. Ready (placeholder) ================== -->
<div class="card hidden" id="screen-ready">
  <h2>ì¤€ë¹„ ì™„ë£Œ</h2>
  <p>ì´ì œë¶€í„° ì‹¤í—˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.</p>
  <button id="btnContinue">ê³„ì†</button>
</div>

  <!-- ================== 2b. Study ================== -->
<div class="card hidden" id="screen-study">
  <h2>í•™ìŠµ(Study)</h2>
  <p class="note" id="studyProgress">
    ì´ í•™ìŠµ ë‹¨ê³„ì—ì„œëŠ” ê·¸ë¦¼ê³¼ í•¨ê»˜ í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ë¥¼ ë¯¸ë¦¬ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.<br>
    ì´í›„ ë‹¨ê³„ì—ì„œëŠ” ê¸€ìê°€ ì—†ì´ ê·¸ë¦¼ë§Œ ì œì‹œë˜ê¸° ë•Œë¬¸ì—,<br>
    ê·¸ë¦¼ê³¼ ë‹¨ì–´ì˜ ì—°ê²°ì„ ì˜ ìµí˜€ ì£¼ì„¸ìš”.  <br><br>
    ê° ê·¸ë¦¼ì€ ì ê¹ì”© ìë™ìœ¼ë¡œ ì œì‹œë©ë‹ˆë‹¤.<br>
    í™”ë©´ì— ë‚˜ì˜¤ëŠ” ê·¸ë¦¼ê³¼ ë‹¨ì–´ë¥¼ ê·¸ëŒ€ë¡œ ë³´ê³  ê¸°ì–µí•´ ì£¼ì„¸ìš”.<br>
    í•™ìŠµì€ ë¹ ë¥´ê²Œ 2íšŒ ë°˜ë³µë©ë‹ˆë‹¤.<br><br>
    í•™ìŠµì´ ëë‚˜ë©´, ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•˜ëŠ” ë²„íŠ¼ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
  </p>

  <!-- ğŸ”’ ê³ ì • ë†’ì´ ì‹œê° ì˜ì—­ -->
  <div style="
    height:380px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
  ">
    <div id="fixation" class="hidden" style="font-size:48px;">+</div>
    <img id="studyImg" class="hidden" style="max-width:420px; max-height:320px;">
    <div id="studyLabel" class="hidden" style="font-size:28px; margin-top:10px;"></div>
  </div>

  <!-- ğŸ”’ ë²„íŠ¼ì€ í•­ìƒ ê°™ì€ ìœ„ì¹˜ -->
  <div style="margin-top:16px; text-align:center;">
    <button id="btnStartStudy">í•™ìŠµ ì‹œì‘</button>
    <button id="btnNextAfterStudy" class="hidden">ë‹¤ìŒ (4ì§€ì„ ë‹¤ í…ŒìŠ¤íŠ¸)
    </button>
  </div>
</div>
  
<!-- ================== 2c. Study test- 4AFC ================== -->
<div class="card hidden" id="screen-afc">
  <h2>4ì§€ì„ ë‹¤ í…ŒìŠ¤íŠ¸</h2>
  <p class="note" id="afcProgress"></p>

  <div style="text-align:center;">
    <img id="afcImg" style="max-width:420px; max-height:320px;" />
  </div>

  <div id="afcChoices"></div>
  <p class="note" id="afcTimer"></p>

  <button id="btnNextAFC" class="hidden">ë‹¤ìŒ</button>
</div>


<!-- ================== 3. Contact (PII separated) ================== -->
<div class="card hidden" id="screen-contact">
  <h2>ë³´ìƒìš© ì—°ë½ì²˜</h2>
  <p class="note">
    ì´ ì •ë³´ëŠ” ì‹¤í—˜ ë°ì´í„°ì™€ ë¶„ë¦¬ë˜ì–´ ì €ì¥ë˜ë©°,<br>
    ë³´ìƒ ì§€ê¸‰ í›„ ì‚­ì œë©ë‹ˆë‹¤.
  </p>

  <label for="contactValue">ë³´ìƒìš© íœ´ëŒ€í° ë²ˆí˜¸</label>
<input id="contactValue"
       placeholder="ì˜ˆ: 010-1234-5678"
       inputmode="numeric"
       autocomplete="tel"
       autocorrect="off"
       autocapitalize="off" />
<div class="note">
  ë³´ìƒ ë°œì†¡ ëª©ì ì—ë§Œ ì‚¬ìš©ë˜ë©°, ì‹¤í—˜ ë°ì´í„°ì™€ ë¶„ë¦¬ ì €ì¥ë©ë‹ˆë‹¤.
</div>

  <button id="btnSubmitContact">ì œì¶œí•˜ê³  ì¢…ë£Œ</button>
</div>

<!-- ================== JS LOGIC ================== -->
<script type="module">
import { jsonp, createSession, appendRow } from "./js/api.js";

/* ---------- DOM ---------- */
const screenConsent = document.getElementById("screen-consent");
const screenReady   = document.getElementById("screen-ready");
const screenContact = document.getElementById("screen-contact");

const consentCheck = document.getElementById("consentCheck");
const nickEl = document.getElementById("nick");
const birthYMEl = document.getElementById("birthYM");
const nativeLangEl = document.getElementById("nativeLang");
const otherLangsEl = document.getElementById("otherLangs");
const btnStart = document.getElementById("btnStart");
const loadingEl = document.getElementById("loading");

const btnContinue = document.getElementById("btnContinue");
const contactTypeEl = document.getElementById("contactType");
const contactValueEl = document.getElementById("contactValue");
const btnSubmitContact = document.getElementById("btnSubmitContact");

const STUDY_ITEMS = [
  { itemId:"mushroom", img:"./stim/PICTURE_177.png", word:"ë²„ì„¯" },
  { itemId:"kitchen",  img:"./stim/PICTURE_730.png",  word:"ë¶€ì—Œ" },
  { itemId:"spider",   img:"./stim/PICTURE_38.png",   word:"ê±°ë¯¸" },
  { itemId:"stairs",   img:"./stim/PICTURE_500.png",   word:"ê³„ë‹¨" },
  { itemId:"apple",    img:"./stim/PICTURE_552.png",    word:"ì‚¬ê³¼" },
  { itemId:"pizza",    img:"./stim/PICTURE_489.png",    word:"í”¼ì" }
];
  
const screenStudy = document.getElementById("screen-study");
const studyProgressEl = document.getElementById("studyProgress");
const fixationEl = document.getElementById("fixation");
const studyImgEl = document.getElementById("studyImg");
const studyLabelEl = document.getElementById("studyLabel");
const btnStartStudy = document.getElementById("btnStartStudy");
const btnNextAfterStudy = document.getElementById("btnNextAfterStudy");


const STUDY_TIMING = {
  fixation: 150,
  picOnly: 500,
  picPlusLabel: 500,
  iti: 50
};

const screenAFC = document.getElementById("screen-afc");
const afcImgEl = document.getElementById("afcImg");
const afcChoicesEl = document.getElementById("afcChoices");
const afcProgressEl = document.getElementById("afcProgress");
const afcTimerEl = document.getElementById("afcTimer");
const btnNextAFC = document.getElementById("btnNextAFC");

  /* =========================
   Study ì‹¤í–‰ ì—”ì§„
   ========================= */

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function shuffle(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

async function runStudyPass(passNum) {
  const order = shuffle(STUDY_ITEMS);

  for (let t = 0; t < order.length; t++) {
    const it = order[t];
    studyProgressEl.textContent =
      `í•™ìŠµ ${passNum}/2 â€” ${t + 1}/${order.length}`;

    // fixation
    fixationEl.classList.remove("hidden");
    studyImgEl.classList.add("hidden");
    studyLabelEl.classList.add("hidden");
    await sleep(STUDY_TIMING.fixation);

    // picture only
    fixationEl.classList.add("hidden");
    studyImgEl.src = it.img;
    studyImgEl.classList.remove("hidden");
    const picOn = Date.now();
    await sleep(STUDY_TIMING.picOnly);

    // picture + label
    studyLabelEl.textContent = it.word;
    studyLabelEl.classList.remove("hidden");
    const labelOn = Date.now();
    await sleep(STUDY_TIMING.picPlusLabel);

    // clear
    studyImgEl.classList.add("hidden");
    studyLabelEl.classList.add("hidden");
    await sleep(STUDY_TIMING.iti);
  }
}

async function runStudy2Passes() {
  // ğŸ”’ í•™ìŠµ ì¤‘ ë²„íŠ¼ ìˆ¨ê¹€
  btnStartStudy.classList.add("hidden");
  btnNextAfterStudy.classList.add("hidden");
  
  btnStartStudy.disabled = true;
  btnStartStudy.textContent = "í•™ìŠµ ì§„í–‰ ì¤‘â€¦";

  await appendRow({
    event: "study_start",
    ts_iso: new Date().toISOString(),
    pid: session.pid,
    sessionId: session.sessionId,
    phase: "study"
  });

  // ---- ì—¬ê¸°ì„œë¶€í„° ì‹¤ì œ í•™ìŠµ ----
  await runStudyPass(1);
  await sleep(400);
  await runStudyPass(2);

  await appendRow({
    event: "study_end",
    ts_iso: new Date().toISOString(),
    pid: session.pid,
    sessionId: session.sessionId,
    phase: "study"
  });

  // ---- í•™ìŠµ ì¢…ë£Œ ì²˜ë¦¬ ----
  studyProgressEl.textContent =
  "í•™ìŠµì´ ëë‚¬ìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•´ ì£¼ì„¸ìš”.";
  
  // ğŸ‘‰ ì—¬ê¸°ì„œ ë‹¤ìŒ ë²„íŠ¼ ë“±ì¥
  btnStartStudy.classList.add("hidden");
  btnNextAfterStudy.classList.remove("hidden");
  btnNextAfterStudy.disabled = false;


}
  
function getRandomDistractors(correctItem, allItems, n = 3) {
  const pool = allItems.filter(it => it.itemId !== correctItem.itemId);
  const shuffled = shuffle(pool);
  return shuffled.slice(0, n);
}

/* ---------- STATE ---------- */
let assignedGroup = null;   // overt / covert / nonaming (ì°¸ê°€ìì—ê²Œ ì•ˆ ë³´ì„)
let session = null;

/* ---------- UTIL ---------- */
const show = el => el.classList.remove("hidden");
const hide = el => el.classList.add("hidden");

function generatePid() {
  const d = new Date();
  return "P" +
    d.toISOString().replace(/[-:.TZ]/g,"") +
    "-" + Math.random().toString(36).slice(2,6).toUpperCase();
}

function validateForm() {
  btnStart.disabled = !(
    consentCheck.checked &&
    nickEl.value.trim().length >= 2 &&
    /^\d{4}-\d{2}$/.test(birthYMEl.value) &&
    nativeLangEl.value.trim() &&
    otherLangsEl.value.trim()
  );
}

const AFC_TIME_LIMIT = 2000; // 2ì´ˆ
let afcOrder = [];
let afcIndex = 0;
let afcTimer = null;

function startAFC() {
  afcOrder = shuffle(STUDY_ITEMS);
  afcIndex = 0;

  appendRow({
    event: "afc_start",
    ts_iso: new Date().toISOString(),
    pid: session.pid,
    sessionId: session.sessionId,
    phase: "afc"
  });

  runNextAFCTrial();
}

function runNextAFCTrial() {
  if (afcIndex >= afcOrder.length) {
    endAFC();
    return;
  }

  const it = afcOrder[afcIndex];
  afcProgressEl.textContent =
    `ë¬¸í•­ ${afcIndex + 1} / ${afcOrder.length}`;

  afcImgEl.src = it.img;

  // ì„ íƒì§€ êµ¬ì„±
  const distractors = getRandomDistractors(it, STUDY_ITEMS, 3);
  const options = shuffle([
    { word: it.word, correct: true },
    ...distractors.map(d => ({ word: d.word, correct: false }))
  ]);

  afcChoicesEl.innerHTML = "";
  const trialStart = Date.now();

  options.forEach(opt => {
    const btn = document.createElement("button");
    btn.textContent = opt.word;
    btn.onclick = () => {
      if (answered) return;
      answered = true;
      clearInterval(afcTimer);
      lockAFCTrial(opt, trialStart);
    };
    afcChoicesEl.appendChild(btn);
  });

  let remaining = AFC_TIME_LIMIT;
  afcTimerEl.textContent = `ë‚¨ì€ ì‹œê°„: ${remaining} ms`;

  let answered = false;

  afcTimer = setInterval(() => {
    remaining -= 100;
    afcTimerEl.textContent = `ë‚¨ì€ ì‹œê°„: ${remaining} ms`;
  
    if (remaining <= 0) {
      clearInterval(afcTimer);
      lockAFCTrial(null, trialStart); // â¬… ìë™ ì§„í–‰ X
    }
  }, 100);
}

function handleAFCResponse(opt, trialStart) {
  if (afcTimer) clearInterval(afcTimer);

  const rt = Date.now() - trialStart;
  const correct = opt ? opt.correct : false;
  const responseWord = opt ? opt.word : "";

  const it = afcOrder[afcIndex];

  appendRow({
    event: "afc_trial",
    ts_iso: new Date().toISOString(),
    pid: session.pid,
    sessionId: session.sessionId,
    primeModeGroup: assignedGroup,
    phase: "afc",
    trialIndex_phase: afcIndex + 1,
    itemId: it.itemId,
    targetWord: it.word,
    responseWord,
    correct,
    rt_ms: rt
  });

  afcIndex++;
  runNextAFCTrial();
}

function endAFC() {
  appendRow({
    event: "afc_end",
    ts_iso: new Date().toISOString(),
    pid: session.pid,
    sessionId: session.sessionId,
    phase: "afc"
  });

  alert("4ì§€ì„ ë‹¤ í…ŒìŠ¤íŠ¸ê°€ ëë‚¬ìŠµë‹ˆë‹¤.");
  // ë‹¤ìŒ ë‹¨ê³„: ì˜¤ë‹µ ì¬í•™ìŠµ or ë³¸ ì‹¤í—˜
}

function lockAFCTrial(opt, trialStart) {
  const rt = opt ? (Date.now() - trialStart) : null;
  const correct = opt ? opt.correct : false;
  const responseWord = opt ? opt.word : "";
  const timeout = opt === null;

  // ë²„íŠ¼ ì „ë¶€ ë¹„í™œì„±í™”
  [...afcChoicesEl.children].forEach(b => b.disabled = true);

  afcTimerEl.textContent = timeout
    ? "ì‹œê°„ ì´ˆê³¼ â€” ë‹¤ìŒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”."
    : "ì‘ë‹µì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.";

  const it = afcOrder[afcIndex];

  // ê²°ê³¼ ì €ì¥ (ì—¬ê¸°ì„œë¶€í„° í•µì‹¬ ë°ì´í„°)
  appendRow({
    event: "afc_trial",
    ts_iso: new Date().toISOString(),
    pid: session.pid,
    sessionId: session.sessionId,
    primeModeGroup: assignedGroup,
    phase: "afc",
    trialIndex_phase: afcIndex + 1,
    itemId: it.itemId,
    targetWord: it.word,
    responseWord,
    correct,
    timeout,
    rt_ms: rt
  });

  // Next ë²„íŠ¼ í™œì„±í™”
  btnNextAFC.classList.remove("hidden");
  btnNextAFC.disabled = false;
}

/* ---------- GROUP ASSIGNMENT (silent) ---------- */
async function assignPrimeMode() {
  try {
    const res = await jsonp({ action:"getGroupCounts" });
    const c = res.counts;
    const groups = ["overt","covert","nonaming"];
    const min = Math.min(...groups.map(g=>c[g]||0));
    const mins = groups.filter(g=>(c[g]||0)===min);
    return Math.random()<0.8
      ? mins[Math.floor(Math.random()*mins.length)]
      : groups[Math.floor(Math.random()*3)];
  } catch {
    return ["overt","covert","nonaming"][Math.floor(Math.random()*3)];
  }
}
assignPrimeMode().then(g=>assignedGroup=g);

/* ---------- EVENTS ---------- */
[consentCheck,nickEl,birthYMEl,nativeLangEl,otherLangsEl]
  .forEach(el=>{
    el.addEventListener("input",validateForm);
    el.addEventListener("change",validateForm);
  });

btnStart.onclick = async () => {
  btnStart.disabled = true;
  show(loadingEl);

  const pid = generatePid();
  const participant = {
    nick: nickEl.value.trim(),
    birthYM: birthYMEl.value,
    nativeLang: nativeLangEl.value.trim(),
    otherLangs: otherLangsEl.value.trim()
  };

  session = await createSession(pid, {
    primeModeGroup: assignedGroup,
    participant
  });

  await appendRow({
    event:"participant_info",
    ts_iso:new Date().toISOString(),
    pid:session.pid,
    sessionId:session.sessionId,
    primeModeGroup:assignedGroup,
    participant_nick:participant.nick,
    participant_birthYM:participant.birthYM,
    participant_nativeLang:participant.nativeLang,
    participant_otherLangs:participant.otherLangs
  });

  hide(screenConsent);
  hide(loadingEl);
  show(screenReady);
};

btnContinue.onclick = () => {
  hide(screenReady);
  show(screenStudy);
  btnStartStudy.classList.remove("hidden");
};

btnStartStudy.onclick = async () => {
  try {
    await runStudy2Passes();
    // TODO: ë‹¤ìŒ ë‹¨ê³„ (4AFC)ë¡œ í™”ë©´ ì „í™˜
  } catch (e) {
    alert("í•™ìŠµ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n" + e.message);
    btnStartStudy.disabled = false;
    btnStartStudy.textContent = "í•™ìŠµ ì‹œì‘";
  }
};

btnNextAfterStudy.onclick = () => {
  hide(screenStudy);
  show(screenAFC);   
  startAFC();        
};
  
btnSubmitContact.onclick = async () => {
  const phone = contactValueEl.value.trim();
  const phoneOk = /^01[016789]-?\d{3,4}-?\d{4}$/.test(phone);

  if (!phoneOk) {
    alert("ë³´ìƒ ê¸°í”„í‹°ì½˜ì„ ë°›ì„ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.\nì˜ˆ: 010-1234-5678");
    return;
  }

  btnSubmitContact.disabled = true; // ğŸ”’ ì ê¸ˆ

  try {
    await jsonp({
      action: "appendContact",
      contact_json: JSON.stringify({
        pid: session.pid,
        sessionId: session.sessionId,
        contact_type: "phone",
        contact_value: phone
      })
    });

    alert("ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!");
    window.location.href = "about:blank";

  } catch (e) {
    btnSubmitContact.disabled = false; // ì‹¤íŒ¨ ì‹œ ë³µêµ¬
    alert("ì—°ë½ì²˜ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n" + e.message);
  }
};

btnNextAFC.onclick = () => {
btnNextAFC.classList.add("hidden");
afcIndex++;
runNextAFCTrial();
};

</script>
</body>
</html>







